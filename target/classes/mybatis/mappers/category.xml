<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="category">

<insert id="insertcategory" parameterType="com.javaex.vo.CategoryVo">
	<selectKey keyProperty="cateNo" resultType="int" order="BEFORE">
	select Seq_category_No.Nextval from dual
	</selectKey>
	<![CDATA[
	
		insert into category (  cateNo, 
                        		id, 
                        		cateName, 
                        		description, 
                        		regDate)
 		values (	#{cateNo},
            		#{id},
            		#{cateName},
            		#{description},
            		sysdate)
	]]>	
</insert>


<select id="selectList" parameterType="String"  resultType="com.javaex.vo.CategoryVo">
	<![CDATA[
		
	select 		t.cateno as cateno,
        		t.cateName as cateName,
        		t.description as description,
        		d.cnt as count
		from category t join ( 
                                select 	c.cateno as cate,
                                		nvl(count(p.postno),0) as cnt
                                from  category c left outer join post p
                                on p.cateno =c.cateno
                                where id= #{id}
                                group by c.cateno) d
		on d.cate = t.cateno
		order by t.cateno desc
	]]>
</select>

<select id="selectByCateNo" parameterType="int" resultType="com.javaex.vo.CategoryVo">
	<![CDATA[
		
	select  t.cateno as cateno,
        		t.cateName as cateName,
        		t.description as description,
        		d.cnt as count
		from category t join ( 
                                select 	c.cateno as cate,
                                		nvl(count(p.postno),0) as cnt
                                from  category c left outer join post p
                                on p.cateno =c.cateno
                                where c.cateno =#{cateNo}
                                group by c.cateno) d
		on d.cate = t.cateno
		order by t.cateno desc
]]>
</select>

<delete id="deleteCategory" parameterType="int">
	<![CDATA[
		delete from category where cateno = #{cateNo} 
	]]>
</delete>
<select id="selectForPost" resultType="com.javaex.vo.CategoryVo">
	<![CDATA[
 		select cateno, catename from category
	]]>
</select>

</mapper>